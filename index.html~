asdfsdfafd<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html {
            background-color: rgb(251, 251, 251);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #song_list {
            padding-top: 10px;
            padding-bottom: 10px;
            overflow-x: hidden;
            overflow-y: auto;
        }

        #artist_list {
            padding-top: 10px;
            padding-bottom: 10px;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .artist_cell {
            border: 1px solid #fcfcfc;
            padding: 7px;
            font-size: 1.2em;
            font-weight: bold;
            font-family: 'Bitter', serif;
        }
        .artist_cell:hover {
            cursor: pointer;
            background-color: #FFF;
            border: 1px dashed #ddd;
            border-right: none;
            color: #000;
            box-shadow: inset 3px 3px 5px 0px #EEE;
         }
        .artist_cell:active {
            background-color: #FFF;
            box-shadow: none;
        }
        .artist_art {
            width: 30px;
            height: 30px;
        }
        .album_art {
            margin-right: 10px;
            width: 150px;
            height: 150px;
        }
        .selected_artist {
            
            background-color: #FFF;
             border: 1px solid #DDD;
             border-right: none;
             color: #000;
             box-shadow: inset 3px 3px 5px 0px #EEE;
        }
        .album_artist_name {
            font-family: 'Bitter', serif;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .album_name {
            font-family: arial, sans-serif;
            font-size: 1.4em;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .song_track {
            width: 20px;
            float: left;
            text-align: right;
            font-family: arial, sans-serif;
            font-size: 0.9em;
            cursor: pointer;
            margin-right: 15px;
            color: #8f8f8f;
        }

        .song_name {
            overflow: hidden;
            font-family: arial, sans-serif;
            font-size: 0.9em;
            cursor: pointer;
        }

        .control_text {
            color: rgb(153, 153, 153);
            text-transform: uppercase;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 11px;
            font-weight: bold;
        }

        .bottom {
            background-color: #FCFCFC;
            border-top: 1px solid #CCC;
            box-shadow: inset 0px 5px 5px 0px #EEE;
        }

    </style>
    <meta name="google" value="notranslate" />
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href='//fonts.googleapis.com/css?family=Bitter:700' rel='stylesheet' type='text/css'>
</head>
<body>
    <br />
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span6">
            </div>
            <div class="span6">
                <form class="form-search pull-right" id="searchform" action="" method="GET">
                    <div class="input-append">
                        <input type="text" id="q" name="q" placeholder="search library" class="input-large search-query ui-autocomplete-input" autocomplete="off"><span role="status" aria-live="polite" class="ui-helper-hidden-accessible"></span>
                        <button type="submit" class="btn" onclick=""><i class="icon-search"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <div class="container-fluid bottom">
        <div class="row-fluid">
            <div class="span5">
                <div id="artist_list">
                    <div class="artist_cell">
                        <div id="all_artists_button">
                            <img class="img-polaroid artist_art" style="padding: 1px; margin-right: 5px;">
                            <span>All Artists</span>
                        </div>
                    </div>
                    <div data-bind="foreach: artists">
                        <div class="artist_cell" data-bind="click: $parent.setSelectedArtist,css: { selected_artist: selected}" >
                            <div>
                                <img class="img-polaroid artist_art" style="padding: 1px; margin-right: 5px;" data-bind="attr:{ src:  $data['art'] == undefined ? 'img/album.png' : art }">
                                <span data-bind="text: name" style="vertical-align: middle;"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="span7">             
                <div id="song_list" data-bind="foreach: artists">
                    <div data-bind="visible: albumVisible" style="clear: both;">
                        <div>
                            <div class="album_artist_name" style="margin-top: 5px;" data-bind="text: name"></div>
                        </div>
                        <div data-bind="foreach: albums">
                           <div data-bind="if:songs().length">
                            <div class="media" style="padding-bottom: 10px;">

                                <img class="album_art img-polaroid media-object pull-left" data-bind="attr: { src:  $data['art'] == undefined ? 'img/album.png' : art }" />
                                    <div class="album_name" data-bind="text: name"></div>
                                    <div>
                                    
                                            <div data-bind="foreach: songs">
                                                <div style="padding-bottom: 3px;" data-bind="click: playSong.bind($data)">
                                                    <div class="song_track" data-bind="text: track"></div>
                                                    <div class="song_name" data-bind="text: name"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="js/jquery.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/jquery.timeago.js"></script>
<script src="js/knockout-2.2.1.debug.js"></script>
<script src="js/codecs.min.js"></script>
<script src="js/knockout.mapping-latest.debug.js"></script>
<script>
    var player = null;
    
    function playSong(song) {
        if (player != null) {
            player.stop();
        }
        player = new Player.fromURL("/musik/api/" + song.path());
        player.volume = 50;
        player.play();
    }
    

    var music = null;
    var ArtistViewModel = function (d, music) {
        ko.mapping.fromJS(d, {}, this);
        this.selected = ko.computed(function () {
            return music.selectedArtist() == this._key();
        }, this);

        this.albumVisible = ko.computed(function () {
            return music.selectedArtist() == null || music.selectedArtist() == this._key();
        }, this);

    }
    var MusicViewModel = function (d) {
        var self = this;
        var mapping = {
            'artists': {
                create: function (options) {
                    return new ArtistViewModel(options.data, self);
                }
            }
        }
        ko.mapping.fromJS(d, mapping, this);
        self.selectedArtist = ko.observable(null);
        self.setSelectedArtist = function (artist) {
            self.selectedArtist(artist._key());
        }
    }
    $(document).ready(function () {
        $("#all_artists_button").click(function () {
            music.selectedArtist(null);
        });

        $.getJSON('/musik/api/songs', function (data) {
            music = new MusicViewModel(data);
            ko.applyBindings(music);
        });

    
        function adjustedHeight() {
            var artist_space = $(window).height() - $("#artist_list").offset().top;
            $("#artist_list").css('max-height', artist_space - 20 + 'px');

            var song_space = $(window).height() - $("#song_list").offset().top;
            $("#song_list").css('max-height', song_space - 20 + 'px');

        }
        $(window).resize(function () {
            adjustedHeight();
        });
        adjustedHeight();
    });
</script>
</html>
